# 鉄筋切断最適化システム

鉄筋の切断ストック問題を解決する最適化システムです。標準的な原材料長から様々な長さの鉄筋を切断する際に、材料の無駄を最小化する最適な切断パターンを計算します。

## プロジェクト概要

このシステムは5種類の鉄筋径（D10、D13、D16、D19、D22）に対応し、深さ優先探索と整数線形計画法を組み合わせて最適な切断計画を立案します。

## 主要コンポーネント

### コアモジュール

1. **切断最適化器** (`cutting_optimizer_ver2.py`): 整数線形計画法を使用して切断ストック問題を解決
2. **データリーダー** (`read_xlsx.py`): 切断要件を含むExcelファイルを解析
3. **ウェブインターフェース** (`cutting_optimizer_streamlit.py`): Streamlitベースのユーザーインターフェース

### 主要アルゴリズム

- **深度優先探索（DFS）**: 材料制約内でのすべての有効な切断組み合わせを生成
- **整数線形計画法（ILP）**: PuLPライブラリを使用して無駄を最小化する切断パターンを最適化
- **列生成法**: `cutting_optimizer_dual.py`での実験的アプローチ（未完成）

## 対応鉄筋規格

システムは5種類の鉄筋径とそれぞれの利用可能な原材料長をサポートしています：

```python
BASE_PATTERNS = {
    'D10': [4000, 4500, 5500, 6000],
    'D13': [3000, 4000, 4500, 5500, 6000, 7500],
    'D16': [4000, 4500, 5500, 6000, 7000],
    'D19': [3500, 4000, 4500, 5500, 6000],
    'D22': [4000, 4500, 5500, 6000]
}
```

## 使用方法

### 必要なライブラリ
- `streamlit`: ウェブインターフェース
- `pulp`: 整数線形計画法ソルバー
- `openpyxl`: Excelファイル処理
- `pandas`: データ処理

### Streamlitアプリケーションの実行
```bash
streamlit run cutting_optimizer_streamlit.py
```

### コマンドライン最適化器の実行
```bash
python cutting_optimizer_ver2.py
```

### 異なる径でのテスト
main関数内の`diameter`変数を変更してください（通常'D10', 'D13', 'D16', 'D19', 'D22'）。

## データ入力形式

### Excelファイル
システムは以下の構造のExcelファイルから切断要件を読み取ります：
- シートに「鉄筋径」ヘッダーが含まれている
- 最初のデータ列にmm単位の長さ値
- 対応する径の列に数量値

## アルゴリズムフロー

1. **データ入力**: Excelから切断要件を読み込み
2. **組み合わせ生成**: DFSを使用して原材料長制約内のすべての有効な切断パターンを探索
3. **最適化**: 需要を満たしながら総無駄を最小化するILPを解く
4. **出力**: 切断指示と廃材を表示

## パフォーマンス考慮事項

- 組み合わせ生成は大規模な問題では計算量が多くなる可能性があります
- デフォルトの最適化タイムアウトは60秒です
- 結果には処理時間、歩留り率、総材料使用量統計が含まれます

## ファイル依存関係

- `cutting_optimizer_streamlit.py` → メインウェブインターフェース
- `cutting_optimizer_ver2.py` → Excelコマンドライン最適化
- `read_xlsx.py` → マルチシート対応Excelファイルパーサー
- Excelファイル: `required_cuts.xlsx` → 入力データ

## テスト

システムには`result/`ディレクトリに、異なる鉄筋径での最適化結果の検証と比較のためのサンプル結果ファイルが含まれています。