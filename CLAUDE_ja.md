# CLAUDE.md

このファイルは、Claude Code (claude.ai/code) がこのリポジトリのコードを操作する際のガイダンスを提供します。

## プロジェクト概要

これは鉄筋切断の切断在庫最適化プロジェクトです。利用可能な在庫棒材から必要な長さの鉄筋片を切断する際の材料廃棄を最小化する、古典的な切断在庫問題を解決します。

## クイックスタート

### 前提条件
必要な依存関係をインストール：
```bash
pip install pandas pulp streamlit tqdm
```

### 基本的な使用方法
1. **コマンドライン最適化の実行**:
   ```bash
   python cutting_optimizer_ver1.py
   ```
   `task.csv`のデータを使用してデフォルトのD19径で実行されます。

2. **Webインターフェースの実行**（最もユーザーフレンドリー）：
   ```bash
   streamlit run streamlit_cutting_app.py
   ```
   ブラウザでhttp://localhost:8501を開いてインタラクティブインターフェースを使用。

3. **鉄筋径の変更**： 
   スクリプト内の`diameter`変数を編集（cutting_optimizer_ver1.pyの139行目）：
   ```python
   diameter = 'D10'  # オプション: D10, D13, D16, D19, D22
   ```

### 期待される出力
オプティマイザーは以下を表示します：
- 切断パターン：`棒の長さ = [切断1, 切断2, ...] [廃棄物]`
- 処理時間、総ロス、材料使用量、歩留まり率
- すべての要求が満たされていることの検証

## コアアーキテクチャ

### アルゴリズムのバージョン
- **cutting_optimizer_ver1.py**: バックトラッキングと線形計画法を使用したメイン最適化エンジン
- **cutting_optimizer_ver2.py**: 列生成・分枝価格法の未完成実装
- **subset_sum_solver_ver1.py**: 組み合わせ発見のためのバックトラッキングアルゴリズム
- **subset_sum_solver_ver2.py**: 部分和ソルバーの最適化版
- **cutting_comb_ver1-4.py**: 様々な切断組み合わせ生成アプローチ

### 主要コンポーネント

1. **データ入力システム** (`read_csv.py:46-72`)
   - `base_pattern.csv`から鉄筋仕様を、`task.csv`から切断要求を読み取り
   - 各径に対して利用可能な棒の長さと必要切断仕様を返す

2. **組み合わせ生成** (`cutting_optimizer_ver1.py:16-96`)
   - バックトラッキングを使用してすべての有効な切断組み合わせを発見
   - 利用可能な棒の長さに収まる組み合わせをフィルタリング
   - 材料効率順（最小廃棄物順）でソート

3. **線形計画法最適化** (`cutting_optimizer_ver1.py:98-136`)
   - PuLPライブラリを使用して切断在庫問題を整数線形計画として解決
   - すべての切断要求を満たしながら総材料ロスを最小化

4. **Webインターフェース** (`streamlit_cutting_app.py`)
   - 要求入力と結果表示のためのインタラクティブなWeb UI
   - CSVアップロードと手動入力の両方をサポート
   - 切断パターン、材料利用率、ダウンロード可能な結果を表示

## 一般的な開発タスク

### 最適化の実行
```bash
python cutting_optimizer_ver1.py
```

### Streamlit Webアプリの実行
```bash
streamlit run streamlit_cutting_app.py
```

### 異なる径のテスト
メインスクリプトの径変数を変更（D10、D13、D16、D19、D22がサポートされています）。

## 依存関係

プロジェクトに必要なライブラリ：
- `pandas`: CSV データ処理
- `pulp`: 線形計画法最適化
- `streamlit`: Webインターフェース
- `tqdm`: プログレスバー（cutting_comb_ver4.py）

インストール:
```bash
pip install pandas pulp streamlit tqdm
```

## データ形式

### base_pattern.csv
各鉄筋径に対する利用可能な棒の長さを定義：
```csv
,D10,D13,D16,D19,D22
"4,000",◯,◯,◯,◯,◯
"4,500",◯,◯,◯,◯,◯
```

### task.csv  
必要な切断数量を指定：
```csv
,鉄筋経,D10,D13,D16,D19,D22
1,4495,1,,,2,
2,3585,2,,,10,
```

## 主要アルゴリズム

### バックトラッキング組み合わせ生成 (`subset_sum_solver_ver2.py:8-45`)
剪定を含む再帰的バックトラッキングを使用して、利用可能な棒の長さに収まる必要切断のすべての一意な組み合わせを生成します。

### 線形計画法の定式化 (`cutting_optimizer_ver1.py:98-136`)
- **変数**: 各切断パターンが使用される回数
- **目的関数**: 総材料廃棄物の最小化
- **制約**: 各必要長さの正確な需要を満たす

### ペナルティベースヒューリスティック (`cutting_comb_ver4.py:71-216`)
正確な解が実行不可能な場合に、廃棄物最小化対過剰生産のバランスを取るためのペナルティパラメータを使用する代替アプローチ。

## テストと検証

各オプティマイザーは、生産された総切断数が必要数量と正確に一致することを確認して結果を検証します。結果には以下が含まれます：
- 使用された総材料長
- 材料廃棄物（ロス）
- 歩留まり率パーセンテージ
- 詳細な切断パターン

## パフォーマンスの考慮事項

- 組み合わせ生成は問題サイズに対して指数的
- 本番環境では`cutting_optimizer_ver1.py`を使用 - 最も安定した実装
- `cutting_comb_ver4.py`は困難なインスタンスのパラメータ調整を含む
- 処理時間は問題の複雑さによって大幅に変わる